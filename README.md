# mojort

## Downloading the project

```bash
git clone git@gitlab.soft.vub.ac.be:perfsys/papers/mojort.git
cd mojort/
git submodule update --init --recursive
```

## Setting up the environment

```bash
./configure.sh
. ./.venv/bin/activate
```

## Requirements

### stress-ng

The cyclictest requires stress-ng to be installed on the host system.
On ubuntu ths can be installed using `sudo apt install stress-ng`

### Docker

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
# Reboot
```

### Install the NVIDIA Container Toolkit

See instructions on [NVIDIA's website](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html).


## Docker container

### Starting the docker container

```bash
./rundocker.py
```
This may take A while to setup

### Seting up the environment inside of the docker container

```bash
. ~/.mojort/.venv/bin/activate
```

### Example of building and running a Mojo file

```bash
cd ~/workspace/mojort/benchmarks/mojo/
mojo build loop_constant.mojo -o loop_constant
./loop_constant
```

## Run benchmarks

The benchmarks wil automaticaly make use of the docker container that
was described in the previous steps.
Run the following commands outside of the docker container.

### Microbenchmarks

```bash
python3 mojort/campaigns/microbenches.py
mkdir -p notebooks/results
mv results/ notebooks/results/microbenches
```

### GPU benchmarks

```bash
python3 mojort/campaigns/gpu.py
mkdir -p notebooks/results
mv results/ notebooks/results/gpu
```

### Filesize benchmarks

```bash
python3 mojort/campaigns/size.py
mkdir -p notebooks/results
mv results/ notebooks/results/size
```

### Cyclictest benchmarks

```bash
python3 mojort/campaigns/cyclictest.py
mkdir -p notebooks/results
mv results/ notebooks/results/cyclictest
```

## Graphs

### Paths

The graphs are generated using a python notebook found in `/notebooks`.
These depend on data generated by running the benchmarks.

To avoid conflict/overwriting data the relevant csv have been copied
(see above) over to the correct paths for the notebook to use.
These paths are:
- microbenchmarks: `notebooks/results/microbenches`
- gpubenchmarks: `notebooks/results/gpu`
- cyclictestbenchmarks : `notebooks/results/cyclictest`
- filesizebenchmarks: `notebooks/results/size`

Graphs will automaticaly be exported to `/tmp/figures/generated`.

### Generating graphs

If all files are in the correct places running the notebook should be
enough to generate all graphs.
