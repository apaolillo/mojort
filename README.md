# mojort

## Package dependencies

We support running experiments on Ubuntu 24.04.
They depend on dependencies, as well as specific kernel images:

```bash
sudo apt update
sudo apt install -y git stress-ng python3 python3-venv curl
sudo apt install -y linux-image-6.14.0-34-generic linux-image-6.8.1-1015-realtime linux-image-6.8.0-87-generic
```

## Downloading the project

```bash
git clone git@github.com:apaolillo/mojort.git
cd mojort/
git submodule update --init --recursive
```

If SSH is not configured on your system, update the submodules as follows:

```bash
git -c url."https://github.com/".insteadOf=git@github.com: -c url."https://".insteadOf=git:// submodule update --init --recursive
```

## Setting up the environment

```bash
./configure.sh
. ./.venv/bin/activate
```

## Docker

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
# Reboot
```

## Install the NVIDIA Container Toolkit

See instructions on [NVIDIA's website](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html).


## Docker container

### Starting the docker container

Build the docker image and run the container:
```bash
./rundocker.py
```

This takes a while the first time before the docker image is saved in the
docker cache. The subsequent runs should be fast.

To set the "Mojo venv" inside the docker container:

```bash
. ~/.mojort/.venv/bin/activate
```

You may try building and running a Mojo example file:

```bash
cd ~/workspace/mojort/benchmarks/mojo/
mojo build loop_constant.mojo -o loop_constant
./loop_constant
```

## Run the benchmarks

The benchmarks will automatically use the docker image built above.
Run the following commands outside the docker container.

### Microbenchmarks

```bash
python3 mojort/campaigns/microbenches.py
mkdir -p notebooks/results
mv results/ notebooks/results/microbenches
```

### GPU benchmarks

```bash
python3 mojort/campaigns/gpu.py
mkdir -p notebooks/results
mv results/ notebooks/results/gpu
```

### Filesize benchmarks

```bash
python3 mojort/campaigns/size.py
mkdir -p notebooks/results
mv results/ notebooks/results/size
```

### Cyclictest benchmarks

```bash
python3 mojort/campaigns/cyclictest.py
mkdir -p notebooks/results
mv results/ notebooks/results/cyclictest
```

## Graphs

### Paths

The graphs are generated using a python notebook found in `/notebooks`.
These depend on data generated by running the benchmarks.

To avoid conflict/overwriting data the relevant csv have been copied
(see above) over to the correct paths for the notebook to use.
These paths are:
- microbenchmarks: `notebooks/results/microbenches`
- gpubenchmarks: `notebooks/results/gpu`
- cyclictestbenchmarks : `notebooks/results/cyclictest`
- filesizebenchmarks: `notebooks/results/size`

Graphs will automaticaly be exported to `/tmp/figures/generated`.

### Generating graphs

If all files are in the correct places running the notebook should be
enough to generate all graphs.
